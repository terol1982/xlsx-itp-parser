$(document).ready(function(){function uploadFiles(formData){$.ajax({url:'/upload_file',method:'post',data:formData,processData:!1,contentType:!1,xhr:function(){var xhr=new XMLHttpRequest();xhr.upload.addEventListener('progress',function(event){var progressBar=$('.progress-bar');if(event.lengthComputable){var percent=(event.loaded/event.total)*100;progressBar.width(percent+'%');if(percent===100){progressBar.removeClass('active')}}});return xhr}}).done(handleSuccess).fail(function(xhr,status){$('#result').html(status)})}
    function handleSuccess(data){if(data.length>0){var html='';for(var i=0;i<data.length;i++){var res=data[i];if(res.status&&res.results){html+='<div class=""><a href="/'+res.publicPath+'" title="Скачать обработанный файл">'+res.filename+'   ('+res.size+' KB, '+res.results+' строк обработано)</a>  </div>'}else{html+='<div class=""><a href="/'+res.publicPath+'" >Не верный формат файла '+res.filename+'</a></div>'}}
        $('#result').html(html)}else{alert('No images were uploaded.')}}
    $('#fileInput1').on('change',function(){$('.progress-bar').width('0%');let post_data={cmd:'cat',act:'get'};$.ajax({type:'POST',data:post_data,url:'/cmd',dataType:"json",beforeSend:function(){$('#category').text('загрузка категорий...')},success:function(res){if(res.error){$('#category').text('загрузка категорий...')}
        else{$('#category').text(res.categories)}},error:function(){},timeout:5000})});$('#upload-files').on('submit',function(event){event.preventDefault();$('#result').html('Uploading file...')
        var files=$('#fileInput1').get(0).files;var formData=new FormData(document.getElementById('upload-files'));if(files.length===0){alert('Файлы не выбраны!');return!1}
        uploadFiles(formData)})})